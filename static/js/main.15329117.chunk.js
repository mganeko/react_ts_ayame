(this.webpackJsonpreact_ts_ayame=this.webpackJsonpreact_ts_ayame||[]).push([[0],{18:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){"use strict";n.r(t);var o=n(0),a=n(3),i=n.n(a),c=n(5),s=n(7),l=n(8),r=n(1),d=n(11),h=n(10),u=n(2),m=n.n(u),g=n(9),p=n.n(g);n(18);var v=function(e){var t=Object(u.useRef)(null);return Object(u.useEffect)((function(){var n=e.stream,o=0;e.volume&&(o=e.volume);var a=t.current;null!=a?(a.srcObject===n?console.log("useEffect() same stream, so skip:",n):(a.srcObject=n,console.log("useEffect() set stream:",n)),a.volume=o):console.log("useEffect() ref.current NULL")})),console.log("Video rendering, id=%s",e.id),e.controls?Object(o.jsx)("video",{className:"video_with_border",ref:t,id:e.id,width:e.width,height:e.height,autoPlay:!0,muted:!0,playsInline:!0,controls:!0}):Object(o.jsx)("video",{className:"video_with_border",ref:t,id:e.id,width:e.width,height:e.height,autoPlay:!0,muted:!0,playsInline:!0})},b=n(6),j=n(34),f=(n(31),""),y=function(){var e=window.location.search,t=new RegExp("key=([^&=]+)").exec(e),n=null;t&&(n=t[1]);return n}();y&&""!==y&&(f=y);var O="react-ayame-test",x=function(){var e=window.location.search,t=new RegExp("room=([^&=]+)").exec(e),n="";t&&(n=t[1]);return n}();x&&""!==x&&(O=x);var S=Object(j.a)(),C=b.defaultOptions;console.log("Ayame default options:",C),C.clientId=S||C.clientId,f&&(C.signalingKey=f);var V=function(e){Object(d.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(s.a)(this,n),(o=t.call(this,e)).localStream=void 0,o.remoteStream=void 0,o.conn=void 0,o.state=void 0,o.localStream=null,o.state={playing:!1,connected:!1,gotRemoteStream:!1,roomId:O,signalingKey:f,videoCodec:"VP8"},o.startVideoHandler=o.startVideoHandler.bind(Object(r.a)(o)),o.stopVideoHandler=o.stopVideoHandler.bind(Object(r.a)(o)),o.stopVideo=o.stopVideo.bind(Object(r.a)(o)),o.connect=o.connect.bind(Object(r.a)(o)),o.disconnect=o.disconnect.bind(Object(r.a)(o)),o.handleRoomChange=o.handleRoomChange.bind(Object(r.a)(o)),o.handleKeyChange=o.handleKeyChange.bind(Object(r.a)(o)),o.handleCodecChange=o.handleCodecChange.bind(Object(r.a)(o)),o.conn=null,o.remoteStream=null,o}return Object(l.a)(n,[{key:"componentDidMount",value:function(){console.log("App DidMound()")}},{key:"componentWillUnmount",value:function(){console.log("App WillUnmount()"),this.localStream&&this.stopVideo()}},{key:"startVideoHandler",value:function(e){var t=this;if(e.preventDefault(),console.log("start Video"),this.localStream)console.warn("localVideo ALREADY started");else{navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){t.localStream=e,t.setState({playing:!0})})).catch((function(e){return console.error("media ERROR:",e)}))}}},{key:"stopVideoHandler",value:function(e){e.preventDefault(),console.log("stop Video"),this.stopVideo()}},{key:"stopVideo",value:function(){this.localStream&&(this.localStream.getTracks().forEach((function(e){return e.stop()})),this.localStream=null,this.setState({playing:!1}))}},{key:"connect",value:function(e){var t=this;e.preventDefault(),console.log("connect"),this.conn?console.warn("ALREADY connected"):(this.state.signalingKey&&""!==this.state.signalingKey&&(C.signalingKey=this.state.signalingKey),C.video.codec=this.state.videoCodec,console.log("connecting roomId=%s key=%s",this.state.roomId,C.signalingKey),console.log("Ayame connect options:",C),this.conn=Object(b.connection)("wss://ayame-labo.shiguredo.jp/signaling",this.state.roomId,C),this.conn.on("open",(function(e){return console.log("auth:",e.authzMetadata)})),this.conn.on("disconnect",(function(e){console.log("disconnected:",e),t.handleDisconnect()})),this.conn.on("addstream",function(){var e=Object(c.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(n.stream),t.remoteStream=n.stream,t.setState({gotRemoteStream:!0});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.conn.on("removestream",function(){var e=Object(c.a)(i.a.mark((function e(n){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("removestream:",n),t.remoteStream=null,t.setState({gotRemoteStream:!1});case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.conn.connect(this.localStream).then((function(){console.log("connected"),t.setState({connected:!0})})).catch((function(e){console.error("connect ERROR:",e)})))}},{key:"disconnect",value:function(e){e.preventDefault(),console.log("disconnect"),this.handleDisconnect()}},{key:"handleDisconnect",value:function(){this.conn&&(this.conn.disconnect(),this.conn=null),this.remoteStream=null,this.setState({connected:!1,gotRemoteStream:!1})}},{key:"handleRoomChange",value:function(e){this.setState({roomId:e.target.value})}},{key:"handleKeyChange",value:function(e){this.setState({signalingKey:e.target.value})}},{key:"handleCodecChange",value:function(e){this.setState({videoCodec:e.target.value})}},{key:"render",value:function(){return console.log("App render()"),Object(o.jsxs)("div",{className:"App",children:["React-TS Ayame-Labo example",Object(o.jsx)("br",{}),"Video Codec:",Object(o.jsxs)("select",{value:this.state.videoCodec,onChange:this.handleCodecChange,disabled:this.state.connected,children:[Object(o.jsx)("option",{value:"VP8",children:"VP8"}),Object(o.jsx)("option",{value:"VP9",children:"VP9"}),Object(o.jsx)("option",{value:"H264",children:"H264"})]}),"\xa0",Object(o.jsx)("button",{onClick:this.startVideoHandler,disabled:this.state.playing||this.state.connected,children:" Start Video"}),Object(o.jsx)("button",{onClick:this.stopVideoHandler,disabled:!this.state.playing||this.state.connected,children:"Stop Video"}),Object(o.jsx)("br",{}),"SignalingKey: ",Object(o.jsx)("input",{id:"signaling_key",type:"text",value:this.state.signalingKey,onChange:this.handleKeyChange,disabled:this.state.connected}),Object(o.jsx)("br",{}),"Room: ",Object(o.jsx)("input",{id:"room_id",type:"text",value:this.state.roomId,onChange:this.handleRoomChange,disabled:this.state.connected}),Object(o.jsx)("button",{onClick:this.connect,disabled:this.state.connected||!this.state.playing,children:" Connect"}),Object(o.jsx)("button",{onClick:this.disconnect,disabled:!this.state.connected,children:"Disconnect"}),Object(o.jsxs)("div",{className:"VideoContainer",children:[Object(o.jsx)(v,{id:"local_video",width:"160px",height:"120px",stream:this.localStream}),Object(o.jsx)("div",{className:"RemoteContainer",children:Object(o.jsx)(v,{id:"remote_video",width:"320px",height:"240px",volume:.5,controls:!0,stream:this.remoteStream})})]})]})}}]),n}(m.a.Component);p.a.render(Object(o.jsx)(V,{}),document.getElementById("root"))}},[[32,1,2]]]);
//# sourceMappingURL=main.15329117.chunk.js.map